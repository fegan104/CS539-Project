%This function will seperate training set into numBag parts then train
%the given neural net on that data.
%Args:
%   net - The weak learner untrained neural net
%   training - The training set with classes as the last column
%   tesing - The testing set with classes as the last column
%   numBags - the number of bags to use
function acc = BagNN(net,training, testing, numBags)
    trainingClass = training(:, end);
    cv = cvpartition(trainingClass, 'KFold', numBags);
    bags = cell(numBags, 1);
    for i=1:numBags
        data = training(:, 1:end-1)';
        classes = training(:, end)';
        classes = full(ind2vec(classes(cv.training(i))+1));
        net = train(net,data(:, cv.training(i)),classes);
        bags{i} = net;
    end
    testData = testing(:, 1:end-1);
    testClass = testing(:, end);
    classperf(testClass, predictForBag(bags, testData))
acc = 0.4;

function result = predictForBag(bag, X)
    numBags = size(bag);
    preds = zeros(size(X));
    idx = 1;
    for d = X
        predForD = zeros(numBags);
        for i=1:numBags
            predForD(i) = predict(bag{i}, d);
        end
        preds(idx) = mode(predForD)-1;
        idx = idx + 1;
    end
result = mode(preds);